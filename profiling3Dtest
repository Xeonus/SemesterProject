import sys
sys.path.append("/Users/berthola/Desktop/Fiji Scripts")
from dendriticprofiling import correct
from javax.vecmath import Point3f
from ij3d import Image3DUniverse, Content
from customnode import CustomLineMesh
from matrixoperator import Matrix
from dendriticprofiling import getNodeCoordinates

def testprofiling(ID):
  tree = Display.getFront().getLayerSet().findById(ID)

  coords = Matrix(getNodeCoordinates(tree))

  #Define axis vectors and origin
  xnorm = Matrix([[1,0,0]])
  ynorm = Matrix([[0,1,0]])
  znorm = Matrix([[0,0,1]])
  center= Matrix([[0,0,0]])

  #Project nodes onto axis
  dpx=[]
  dpy=[]
  dpz=[]
  m=coords.getRowDimension()
  for i in range(0, m):
    xstore = Matrix([coords.getRow( i )]) * xnorm.transpose()
    ystore = Matrix([coords.getRow( i )]) * ynorm.transpose()
    zstore = Matrix([coords.getRow( i )]) * znorm.transpose()
    dpx.append(xstore.getRow(0))
    dpy.append(ystore.getRow(0))
    dpz.append(zstore.getRow(0))

  #get it back in array form (get rid of list in list of Jarray)

  dpx=[ x[0] for x in dpx]
  dpy=[ x[0] for x in dpy]
  dpz=[ x[0] for x in dpz]
  zipped=zip(dpx, dpy, dpz)
  
  return zipped

def testprofilingmesh(treeID):
  points=testprofiling(treeID)
  return CustomlineMesh(points, CustomLineMesh.PAIRWISE)

def testvisualize():
  univ=Image3DUniverse(512,512)
  for ID in [71887]:
    mesh = testprofilingmesh(ID)
    c = univ.createContent(mesh, str(ID))
    univ.addContent(c)
  univ.show()

testvisualize()
  

"""
#-----------------------------------------
def createMesh(treeID):
  tree = Display.getFront().getLayerSet().findById(treeID)
  points = tree.generateSkeleton(1, 12, 1).verts
  for p in set(points):
    c = correct([p.x, p.y, p.z])
    p.x = float(c[0])
    p.y = float(c[1])
    p.z = float(c[2])
  return CustomLineMesh(points, CustomLineMesh.PAIRWISE)


def visualize():
  univ = Image3DUniverse(512, 512)
  for ID in [71887, 72064, 72175, 72481, 72295, 75408, 75307, 74767, 99481, 74877]:
    mesh = createMesh(ID)
    c = univ.createContent(mesh, str(ID))
    univ.addContent(c)
  univ.show()

visualize()
"""
